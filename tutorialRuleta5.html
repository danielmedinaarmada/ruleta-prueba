<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script src="js/TweenMax.min.js"></script>
  <script src="js/Winwheel.min.js"></script>
</head>
<body>
  
  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='pointerGuide' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="theWheel.startAnimation();">Girar</button>
  </div>

  <script>
    let theWheel = new Winwheel({
      'canvasId' : 'pointerGuide',
      'numSegments' : 4,
      'pointerAngle' : 45,    // Ensure this is set correctly
      'segments' : [          // use pointerGuide to help.
        { 'fillStyle' : '#eae56f', 'text' : 'Segment 1' },
        { 'fillStyle' : '#89f26e', 'text' : 'Segment 2' },
        { 'fillStyle' : '#7de6ef', 'text' : 'Segment 3' },
        { 'fillStyle' : '#e7706f', 'text' : 'Segment 4' }
      ],
      'pointerGuide' : {
        'display' : true,
        'strokeStyle' : '#FF0000',
        'lineWidth' : 3
      }
    });

  </script>


  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='indicatedSegment' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="theWheel1.startAnimation();">Girar</button>
  </div>

  <script>
    
    let theWheel1 = new Winwheel({
      'canvasId'     : 'indicatedSegment',
      //'pointerAngle' : 0,
      'numSegments'  : 8,
      'outerRadius'  : 170,
      'segments' : [
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 1'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 2'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 3'},
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 4'},
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 5'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 6'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 7'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 8'}
      ],
      'pointerGuide' : {
          'display' : true,
          'strokeStyle' : '#FF0000',
          'lineWidth' : 2
        },
      'animation' : {
        'type'      : 'spinToStop',
        'duration'  : 5,
        'spins'     : 8,
        // Remember to do something after the animation has finished specify callback function
        'callbackFinished' : 'alertPrize()',
        // During the animation need to call the drawTriangle() to re-draw the pointer each frame.
        'callbackAfter' : 'drawTriangle()'
      }
    });

    drawTriangle();

    function alertPrize(){
      // Call getIndicatedSegment() function to return pointer to the segment pointed to on wheel
      let winningSegment = theWheel1.getIndicatedSegment();
      //Basic alert of the segment text wich is the prize name  
      alert(`You have won ${winningSegment.text} !`);
    }

    function drawTriangle(){
      // Get the canvas context the wheel uses.
      let ctx = theWheel1.ctx;

      ctx.strokeStyle = 'navy';   // set line colour
      ctx.fillStyle = 'aqua';     // set fill colour
      ctx.lineWidth = 2;
      ctx.beginPath();            // Begin path
      ctx.moveTo(170,5);          // Move to initial position
      ctx.lineTo(230,5);          // Draw lines to make the shape
      ctx.lineTo(200,40);
      ctx.lineTo(171,5);
      ctx.stroke();               // Complete the path by stroking (draw lines)
      ctx.fill();                 // Then fill
    }


  </script>



  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='colourCanvas' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="colourWheel.startAnimation();">Girar</button>
  </div>

  <audio id="winsound">
    <source src="mp3/winbeat.mp3">
  </audio>

  <script>
    let colourWheel = new Winwheel({
      'canvasId' : 'colourCanvas',
      'numSegments' : 8,
      'outerRadius' : 170,
      'pointerAngle': 90,
      'segments': [
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 1'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 2'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 3'},
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 4'},
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 5'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 6'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 7'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 8'}
      ],
      'animation' : {
        'type' : 'spinToStop',
        'duration' : 5,
        'spins' : 8,
        // To do something after the animation has finished specify callback function
        'callbackFinished' : 'winAnimation()',
        //During  the animation need  to call function to re-draw triangle
        'callbackAfter' : 'drawColourTriangle()'
      }
    });

    // This function called after the spin animation has stopped
    function winAnimation(){
      // Get the audio with the sound it in, then play
      let winsound = document.getElementById('winsound');
      winsound.play();

      //Get the number of the winning segment
      let winningSegmentNumber = colourWheel.getIndicatedSegmentNumber();

      //Loop and set fillStyle of all segment to gray
      for (let x=1; x < colourWheel.segments.length; x++){
        colourWheel.segments[x].fillStyle = 'gray';
      }

      //Make the Winning one yellow
      colourWheel.segments[winningSegmentNumber].fillStyle = 'yellow';

      // Call draw function to render changes
      colourWheel.draw();

      //Also re-draw the pointer, otherwise it disappears
      drawColourTriangle();
    }

    drawColourTriangle();

    // Draw  pointer on canvas, this time oh the rigth
    function drawColourTriangle(){
      //get context used by the wheel
      let ctx = colourWheel.ctx;

      ctx.strokeStyle = 'navy';   // set line colour
      ctx.fillStyle = 'aqua';     // set fill colour
      ctx.lineWidth = 2;
      ctx.beginPath();            // Beging path
      ctx.moveTo(390, 174);       // Move to initial position
      ctx.lineTo(390, 226);       // draw lines to make the shape
      ctx.lineTo(360, 200);
      ctx.lineTo(390, 175);
      ctx.stroke();
      ctx.fill();                 // Complete the path by stroking (draw lines)
    }

  </script>

  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='stopAngleWheel' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="calculatePrize();">Girar</button>
  </div>

  <script>
    let stopAngleWheel = new Winwheel({
      'canvasId' : 'stopAngleWheel',
      'numSegments' : 8,
      'outerRadius' : 170,
      'segments' : [
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 1' },
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 2' },
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 3' },
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 4' },
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 5' },
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 6' },
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 7' },
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 8' }
      ],
      'animation': {
        'type' : 'spinToStop',
        'duration' : 5,
        'spins' : 8,
        'callbackAfter' : 'drawTriangle()'
      }
    });

    // Function with formula to work out stopAngle before spinning animation-
    // Called from Click of the Spin button.
    function calculatePrize(){
      // This formula alway makes the wheel stop somewhere inside prize 3 at least
      // 1 degree away from the start and end edges of the segment
      let stopAt = (91 + Math.floor(Math.random() * 43));

      //Important thing is to set to stopAngle of the animation before stating the spin.
      stopAngleWheel.animation.stopAngle = stopAt;
      // May as well start the spin from here
      stopAngleWheel.startAnimation();
    }

    //Usual pointer drawing code.
    drawTriangle();

    function drawTriangle(){
      // Get the canvas context the wheel uses
      let ctx = stopAngleWheel.ctx;
      ctx.strokeStyle = 'navy';   // set line colour
      ctx.fillStyle = 'aqua';     // set fill colour
      ctx.lineWidth = 2;
      ctx.beginPath();            // Begin path
      ctx.moveTo(170, 5);        // Move to initial position
      ctx.lineTo(230, 5);         // Draw line to make the shape
      ctx.lineTo(200,40);
      ctx.lineTo(171,5);
      ctx.stroke();               // Complete the path by stroking (draw lines)
      ctx.fill();                 // Then fill
    }


  </script>


  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='server-side-calculate-prize' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="calculatePrize();">Girar</button>
  </div>





</body>
</html>