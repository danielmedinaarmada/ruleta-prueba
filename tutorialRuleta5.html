<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script src="js/TweenMax.min.js"></script>
  <script src="js/Winwheel.min.js"></script>
</head>
<body>
  
  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='pointerGuide' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="theWheel.startAnimation();">Girar</button>
  </div>

  <script>
    let theWheel = new Winwheel({
      'canvasId' : 'pointerGuide',
      'numSegments' : 4,
      'pointerAngle' : 45,    // Ensure this is set correctly
      'segments' : [          // use pointerGuide to help.
        { 'fillStyle' : '#eae56f', 'text' : 'Segment 1' },
        { 'fillStyle' : '#89f26e', 'text' : 'Segment 2' },
        { 'fillStyle' : '#7de6ef', 'text' : 'Segment 3' },
        { 'fillStyle' : '#e7706f', 'text' : 'Segment 4' }
      ],
      'pointerGuide' : {
        'display' : true,
        'strokeStyle' : '#FF0000',
        'lineWidth' : 3
      }
    });

  </script>


  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='indicatedSegment' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="theWheel1.startAnimation();">Girar</button>
  </div>

  <script>
    
    let theWheel1 = new Winwheel({
      'canvasId'     : 'indicatedSegment',
      //'pointerAngle' : 0,
      'numSegments'  : 8,
      'outerRadius'  : 170,
      'segments' : [
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 1'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 2'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 3'},
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 4'},
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 5'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 6'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 7'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 8'}
      ],
      'pointerGuide' : {
          'display' : true,
          'strokeStyle' : '#FF0000',
          'lineWidth' : 2
        },
      'animation' : {
        'type'      : 'spinToStop',
        'duration'  : 5,
        'spins'     : 8,
        // Remember to do something after the animation has finished specify callback function
        'callbackFinished' : 'alertPrize()',
        // During the animation need to call the drawTriangle() to re-draw the pointer each frame.
        'callbackAfter' : 'drawTriangle()'
      }
    });

    drawTriangle();

    function alertPrize(){
      // Call getIndicatedSegment() function to return pointer to the segment pointed to on wheel
      let winningSegment = theWheel1.getIndicatedSegment();
      //Basic alert of the segment text wich is the prize name  
      alert(`You have won ${winningSegment.text} !`);
    }

    function drawTriangle(){
      // Get the canvas context the wheel uses.
      let ctx = theWheel1.ctx;

      ctx.strokeStyle = 'navy';   // set line colour
      ctx.fillStyle = 'aqua';     // set fill colour
      ctx.lineWidth = 2;
      ctx.beginPath();            // Begin path
      ctx.moveTo(170,5);          // Move to initial position
      ctx.lineTo(230,5);          // Draw lines to make the shape
      ctx.lineTo(200,40);
      ctx.lineTo(171,5);
      ctx.stroke();               // Complete the path by stroking (draw lines)
      ctx.fill();                 // Then fill
    }


  </script>



  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='colourCanvas' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="colourWheel.startAnimation();">Girar</button>
  </div>

  <audio id="winsound">
    <source src="mp3/winbeat.mp3">
  </audio>

  <script>
    let colourWheel = new Winwheel({
      'canvasId' : 'colourCanvas',
      'numSegments' : 8,
      'outerRadius' : 170,
      'pointerAngle': 90,
      'segments': [
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 1'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 2'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 3'},
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 4'},
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 5'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 6'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 7'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 8'}
      ],
      'animation' : {
        'type' : 'spinToStop',
        'duration' : 5,
        'spins' : 8,
        // To do something after the animation has finished specify callback function
        'callbackFinished' : 'winAnimation()',
        //During  the animation need  to call function to re-draw triangle
        'callbackAfter' : 'drawColourTriangle()'
      }
    });

    // This function called after the spin animation has stopped
    function winAnimation(){
      // Get the audio with the sound it in, then play
      let winsound = document.getElementById('winsound');
      winsound.play();

      //Get the number of the winning segment
      let winningSegmentNumber = colourWheel.getIndicatedSegmentNumber();

      //Loop and set fillStyle of all segment to gray
      for (let x=1; x < colourWheel.segments.length; x++){
        colourWheel.segments[x].fillStyle = 'gray';
      }

      //Make the Winning one yellow
      colourWheel.segments[winningSegmentNumber].fillStyle = 'yellow';

      // Call draw function to render changes
      colourWheel.draw();

      //Also re-draw the pointer, otherwise it disappears
      drawColourTriangle();
    }

    drawColourTriangle();

    // Draw  pointer on canvas, this time oh the rigth
    function drawColourTriangle(){
      //get context used by the wheel
      let ctx = colourWheel.ctx;

      ctx.strokeStyle = 'navy';   // set line colour
      ctx.fillStyle = 'aqua';     // set fill colour
      ctx.lineWidth = 2;
      ctx.beginPath();            // Beging path
      ctx.moveTo(390, 174);       // Move to initial position
      ctx.lineTo(390, 226);       // draw lines to make the shape
      ctx.lineTo(360, 200);
      ctx.lineTo(390, 175);
      ctx.stroke();
      ctx.fill();                 // Complete the path by stroking (draw lines)
    }

  </script>

  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='stopAngleWheel' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="calculatePrize();">Girar</button>
  </div>

  <script>
    let stopAngleWheel = new Winwheel({
      'canvasId' : 'stopAngleWheel',
      'numSegments' : 8,
      'outerRadius' : 170,
      'segments' : [
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 1' },
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 2' },
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 3' },
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 4' },
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 5' },
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 6' },
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 7' },
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 8' }
      ],
      'animation': {
        'type' : 'spinToStop',
        'duration' : 5,
        'spins' : 8,
        'callbackAfter' : 'drawTriangle()'
      }
    });

    // Function with formula to work out stopAngle before spinning animation-
    // Called from Click of the Spin button.
    function calculatePrize(){
      // This formula alway makes the wheel stop somewhere inside prize 3 at least
      // 1 degree away from the start and end edges of the segment
      let stopAt = (91 + Math.floor(Math.random() * 43));

      //Important thing is to set to stopAngle of the animation before stating the spin.
      stopAngleWheel.animation.stopAngle = stopAt;
      // May as well start the spin from here
      stopAngleWheel.startAnimation();
    }

    //Usual pointer drawing code.
    drawTriangle();

    function drawTriangle(){
      // Get the canvas context the wheel uses
      let ctx = stopAngleWheel.ctx;
      ctx.strokeStyle = 'navy';   // set line colour
      ctx.fillStyle = 'aqua';     // set fill colour
      ctx.lineWidth = 2;
      ctx.beginPath();            // Begin path
      ctx.moveTo(170, 5);        // Move to initial position
      ctx.lineTo(230, 5);         // Draw line to make the shape
      ctx.lineTo(200,40);
      ctx.lineTo(171,5);
      ctx.stroke();               // Complete the path by stroking (draw lines)
      ctx.fill();                 // Then fill
    }


  </script>


  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='server-side-calculate-prize' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <button onclick="calculatePriceOnServer();">Girar</button>
  </div>

  <script>
    let serverWheel = new Winwheel({
      'canvasId' : 'server-side-calculate-prize',
      'numSegments' : 8,
      'outerRadius' : 170,
      'segments' : [
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 1'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 2'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 3'},
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 4'},
        { 'fillStyle' : '#eae56f', 'text' : 'Prize 5'},
        { 'fillStyle' : '#89f26e', 'text' : 'Prize 6'},
        { 'fillStyle' : '#7de6ef', 'text' : 'Prize 7'},
        { 'fillStyle' : '#e7706f', 'text' : 'Prize 8'}
      ],
      'animation' : 
      {
        'type' : 'spinToStop',
        'duration' : 5,
        'spins' : 8,
        'callbackAfter' : 'drawTriangle()'
      }
    });

    //In this example I use raw JavaScript to do Ajax, but if you jave Jquery included
    //in your website so might want to use its Ajax features as its a bit less code to write
    let xhr = new XMLHttpRequest();
    xhr.onreadystatechange = ajaxStateChange;

    // Function called onclick of spin button
    function calculatePriceOnServer(){
      // Make get request to the server-side script
      xhr.open('GET', 'http://dougtesting.net/elements/scripts/calculate_prize.php', true);
      xhr.setRequestHeader('Access-Control-Allow-Headers', '*');
      xhr.setRequestHeader('Content-type', 'application/ecmascript');
      xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
      xhr.send('');
    }

    function ajaxStateChange(){
      if(xhr.readyState < 4){
        return;
      }
      if (xhr.status !== 200){
        return;
      }
      // The request has completed.
      if (xhr.readyState === 4){
        let segmentNumber = xhr.responseText; // The segment number should be in response

        if (segmentNumber){
          // Get random angle inside specified segment of the wheel
          let stopAt = serverWheel.getRandomForSegment(segmentNumber);
          // Important thing is to set the stopAngle of the animation before stating the spin.
          serverWheel.animation.stopAngle = stopAt;
          //Start the spin animation here
          serverWheel.startAniamtion();
        }
      }
    }

    // Usual dranwing triangle code
    drawTriangle();

    function drawTriangle(){
      // Get the canvas context the wheel uses
      let ctx = serverWheel.ctx;
      ctx.stokeStyle = 'navy';    // set line colour
      ctx.fillStyle = 'aqua';     // set fill colour
      ctx.lineWidth = 2;
      ctx.beginPath();            //Begin path
      ctx.moveTo(170, 5);         //Move to initial position
      ctx.lineTo(230, 5);         //Draw lines to make the shape
      ctx.lineTo(200, 40);
      ctx.lineTo(171, 5);
      ctx.stroke();               //Complete the path by stroking (draw lines)
      ctx.fill();                 //Then fill
    }

  </script>


  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='segmentClicked' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <p>You clicked: <span id='clickedWhat'></span></p>
  </div>

  <script>
    let segmentClickedWheel = new Winwheel({
      'canvasId': 'segmentClicked',
      'numSegments' : 8,
      'outerRadius' : 170,
      'innerRadius' : 50,
      'textFontSize' : 14,
      'textMargin' : 0,
      'segments' : [
        { 'fillStyle' : '#eae56f', 'text' : 'Segment 1' },
        { 'fillStyle' : '#89f26e', 'text' : 'Segment 2' },
        { 'fillStyle' : '#7de6ef', 'text' : 'Segment 3' },
        { 'fillStyle' : '#e7706f', 'text' : 'Segment 4' },
        { 'fillStyle' : '#eae56f', 'text' : 'Segment 5' },
        { 'fillStyle' : '#89f26e', 'text' : 'Segment 6' },
        { 'fillStyle' : '#7de6ef', 'text' : 'Segment 7' },
        { 'fillStyle' : '#e7706f', 'text' : 'Segment 8' }
      ],
    });    

    // Get canvas and span objects.
    let canvas = document.getElementById('segmentClicked');
    let clickedWhat = document.getElementById('clickedWhat');

    // Specify click handler for canvas.
    canvas.onclick = function(e){
      // Call function to reset the segment colours.
      resetSegmentColours();

      // Call the getSegmentAt function passing the mouse x and y from the event
      let clickedSegment = segmentClickedWheel.getSegmentAt(e.clientX, e.clientY);
      let clickedSegmentNumber = segmentClickedWheel.getSegmentNumberAt(e.clientX, e.clientY);
      console.log (`clickedSegment: ${clickedSegment.fillStyle} clickedSegmentNumber: ${clickedSegmentNumber}`);

      // A pointer to the segment clicked is retuned if the user clicked inside the wheel
      if (clickedSegment){
        // Change background colour of the segment and update the wheel
        clickedSegment.fillStyle = 'yellow';
        segmentClickedWheel.draw();
        // update span to say what was clicked
        clickedWhat.innerText = clickedSegment.text;
      }
    }

    // Reset the segment colours
    function resetSegmentColours(){
      // Reset the colours
      segmentClickedWheel.segments[1].fillStyle = '#eae56f';
      segmentClickedWheel.segments[2].fillStyle = '#89f26e';
      segmentClickedWheel.segments[3].fillStyle = '#7de6ef';
      segmentClickedWheel.segments[4].fillStyle = '#e7706f';
      segmentClickedWheel.segments[5].fillStyle = '#eae56f';
      segmentClickedWheel.segments[6].fillStyle = '#89f26e';
      segmentClickedWheel.segments[7].fillStyle = '#7de6ef';
      segmentClickedWheel.segments[8].fillStyle = '#e7706f';

      // Render change
      segmentClickedWheel.draw();

      // Also blank clicked what text
      clickedWhat.innerText = '';
    }

  </script>

  <div style='border:1px solid black; display: inline-block;'>
    <canvas id='pieGraph' width='400' height='400'>
      Canvas no suported, please use another browser.
    </canvas>
    <p>More Info: <span id='moreInfo'></span></p>
  </div>
  
  <script>
    let graph = new Winwheel({
      'numSegments' : 4,
      'outerRadius' : 170,
      'centerX' : 190,         //By default wheel goes in center of canvas, move left side
      'segments' : [
        // Define segments. The more info property is not a standart parameter of  segments
        // but because JavaScript is loosely typed is I want moreInfo property I can add it
        { 
          'fillStyle' : '#eae56f', 
          'text' : 'Data 1',
          'size': winWheelPercentToDegrees(45),
          'moreInfo' : '<p>Data 1 is the biggest slice of the pie at 45% for this year!</p>'
        },{ 
          'fillStyle' : '#eae56f', 
          'text' : 'Data 2',
          'size': winWheelPercentToDegrees(20),
          'moreInfo' : '<p>Data 2 is selling well making up 20% of our sales.</p>'
        },{ 
          'fillStyle' : '#eae56f', 
          'text' : 'Data 3',
          'size': winWheelPercentToDegrees(5),
          'moreInfo' : '<p>Data 3 only making up 5% of our sales.</p>'
        },{ 
          'fillStyle' : '#eae56f', 
          'text' : 'Data 4',
          'size': winWheelPercentToDegrees(30),
          'moreInfo' : '<p>Data 4 was a strong performer of the last year at 30% of sales.</p>'
        }
      ]
    });
  
    // Call function to draw legend boxes passing x and y co-ordinates of where to start the legend boxes.
    drawLegend(420,90);

    function drawLegend(x,y){
      // Get context to same canvas used by wheel
      let ctx = graph.ctx;

      // Set some HTML 5 canvas drawing options
      ctx.lineWidth = 1;
      ctx.stokeStyle = 'black';
      ctx.font = '14px verdana';

      // Loop though segment in the wheel and create boxes
      for (idx = 1; idx <= graph.numSegments; idx++ ){
        // These are raw canvas function you may want to learn about.
        ctx.beginPath();
        ctx.fillStyle = graph.segments[idx].fillStyle;
        ctx.rect(x,y,40,40);
        ctx.stroke();
        ctx.fill();

        // Do the text centred to the right
        ctx.fillStyle = 'black';
        ctx.fillText(graph.segments[id].text, x + 50, y + 25);

        // Move down after each  one with gap in between
        y += 55;

        // Reset the text fillStyle here so only 1 is red;
        grap.numSegments[idx].textFillStyle = 'black';
      }
    }

    // Get canvas and span objects
    let canvas = document.getElementById('graph');
    let moreInfo = docuemnt.getElementById('moreInfo');

    //Specify click handler for canvas
    canas.onclick = function(e){
      // Call the getSegmentsAt function passing the mouse x and y from the event
      let clickedSegment = graph.getSegmentAt(e.clientX, e.clientY);

      // A pointer to the segment clicked is returned if the user clicked inside the wheel
      if (clickedSegment){
        
        //set more info innerHTML
        moreInfo.innerText = '<h3>' + clickedSegment.text + '</h3>' + clickedSegment.moreInfo;
        //Change clicked segment text to red
        clickedSegment.textFillStyle = 'red';
        grap.draw();

        // Need to re-draw legend and wiped when wheel is re-draw
        drawLegend(420, 90);
      }

    }


  </script>


</body>
</html>